<!DOCTYPE html>
<meta charset="utf-8">

<!-- Load d3.js -->
<script src="https://d3js.org/d3.v4.js"></script>

<!-- Create a div where the graph will take place -->
<div  style="width:800px; margin:0 auto;" id="my_dataviz"></div>


<script src="https://d3js.org/d3.v4.js"></script>


<script>
    
// set the dimensions and margins of the graph
var margin = {top: -100, right: -200, bottom: -100, left: 250},
  width = 850 - margin.left - margin.right,
  height = 850 - margin.top - margin.bottom;

// append the svg object to the body of the page
var svg = d3.select("#my_dataviz")
.append("svg")
  .attr("width", width - 10 + margin.left + margin.right+1000)
  .attr("height", height + margin.top + margin.bottom)
.append("g")
  .attr("transform",
        "translate(" + margin.left + "," + margin.top + ")");
  

d3.json('https://raw.githubusercontent.com/tobeal/trabajoVisual/main/datosSector.json', function (error, data) {

    var dataset = [];
    console.log(data.records)
   data.records.forEach(function(d) {
        
        dataset.push({'x':d[4],'y':d[2],'value': d[7]+d[8]+d[9]+d[10]+d[11]+d[12]+d[13]+d[14]+d[15]+d[16]+d[17]+d[18]+d[19]+d[20]+d[21]+d[22]+d[23]+d[24]+d[25]+d[26]})
        

    });
   console.log(dataset[0].y)
    
var myGroups = ["ALCAZABA", "ALVARADO", "ANTONIO DOMINGUEZ", "BALBOA", "BANASTA", "BARRIADA DE LLERA", "BARRIADA DE LOS COLORINES", "CASCO ANTIGUO", "CERRO DE REYES", "CERRO DE SAN MIGUEL","CERRO GORDO","COLONIA DE AVIACION","COMUNIDAD DE CESPEDES","COMUNIDAD SAN ONOFRE","CORAZON DE JESUS","CUARTON DEL CORTIJO","DEHESILLA DE CALAMON"]
var myVars = ["00-No aplicable por ser menor de 16 a√±os", "NO SABE LEER NI ESCRIBIR", "SIN ESTUDIOS", "GRADUADO ESCOLAR O EQUIVALENTE", "BACHILLER, FP2, EQUIVALENTE O SUPERIOR"]
    // Build X scales and axis:
var x = d3.scaleBand()
  .range([ 10, width ])
  .domain(myGroups)
  .padding(0.01)  ;
svg.append("g")
  .attr("transform", "translate(0," + 750 + ")")

  .call(d3.axisBottom(x))
  .selectAll("text") 
        .style("text-anchor", "end")
        .attr("dx", "-.8em")
        .attr("dy", ".15em")
        .attr("transform", "rotate(-65)");

// Build X scales and axis:
var y = d3.scaleBand()
  .range([ height-300, 100 ])
  .domain(myVars)
  .padding(0.01);
svg.append("g")
  .call(d3.axisLeft(y))
  .attr("transform", "translate(0," + -50 + ")");
 var tooltip = d3.select("#my_dataviz")
    .append("div")
    .style("opacity", 0)
    .attr("class", "tooltip")
    .style("background-color", "white")
    .style("border", "solid")
    .style("border-width", "2px")
    .style("border-radius", "5px")
    .style("padding", "5px")
// Build color scale
var myColor = d3.scaleLinear()
  .range(["white", "#69b3a2"])
  .domain([1,10000])
      // create a tooltip
  var tooltip = d3.select("#my_dataviz")
    .append("div")
    .style("opacity", 0)
    .attr("class", "tooltip")
    .style("background-color", "white")
    .style("border", "solid")
    .style("border-width", "2px")
    .style("border-radius", "5px")
    .style("padding", "5px")

  // Three function that change the tooltip when user hover / move / leave a cell
  var mouseover = function(d) {
    tooltip.style("opacity", 1)
  }
  var mousemove = function(d) {
    tooltip
      .html("The exact value of<br>this cell is: " + d.value)
      .style("left", (d3.mouse(this)[0]+70) + "px")
      .style("top", (d3.mouse(this)[1]) + "px")
  }
  var mouseleave = function(d) {
    tooltip.style("opacity", 0)
  }

  // add the squares
  svg.selectAll()
    .data(dataset, function(d) {return d.x+':'+d.y;})
    .enter()
    .append("rect")
      .attr("x", function(d) { return x(d.x) })
      .attr("y", function(d) { return y(d.y) })
      .attr("width", x.bandwidth() )
      .attr("height", y.bandwidth() )
      .style("fill", function(d) { return myColor(d.value)} )
    .on("mouseover", mouseover)
    .on("mousemove", mousemove)
    .on("mouseleave", mouseleave)
  });
  
</script>